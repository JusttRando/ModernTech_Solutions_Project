<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ModernTech HR — Employees (Simple)</title>

  <!-- Bootstrap CSS (CDN) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="ideas1.css">

  
</head>
<body>
  <div class="app-container">
    <header class="d-flex align-items-center justify-content-between mb-3">
      <h1 class="h4">ModernTech HR — Employees</h1>
      <div>
        <button id="btn-add" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#employeeModal">Add Employee</button>
      </div>
    </header>

    <section class="card p-3 mb-3">
      <div class="row g-2 align-items-center">
        <div class="col-12 col-md-6">
          <input id="search" class="form-control" placeholder="Search by name, email or ID">
        </div>
        <div class="col-12 col-md-6 text-md-end small-muted">
          Data is client-side only; you may provide an external JSON at <code>data/employees.json</code> or edit the embedded sample.
        </div>
      </div>
    </section>

    <section class="card p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th class="col-dept">Department</th>
              <th>Position</th>
              <th>Salary</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="employees-tbody">
            <!-- rows injected by JS -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- Employee Modal (Add / Edit) -->
    <div class="modal fade" id="employeeModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <form class="modal-content" id="employee-form" novalidate>
          <div class="modal-header">
            <h5 class="modal-title">Add / Edit Employee</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="row g-3">
              <div class="col-12 col-md-6">
                <label class="form-label" for="emp-id">Employee ID</label>
                <input id="emp-id" name="id" class="form-control" required>
              </div>
              <div class="col-12 col-md-6">
                <label class="form-label" for="emp-email">Email</label>
                <input id="emp-email" name="email" type="email" class="form-control">
              </div>

              <div class="col-12 col-md-6">
                <label class="form-label" for="emp-first">First name</label>
                <input id="emp-first" name="firstName" class="form-control" required>
              </div>
              <div class="col-12 col-md-6">
                <label class="form-label" for="emp-last">Last name</label>
                <input id="emp-last" name="lastName" class="form-control" required>
              </div>

              <div class="col-12 col-md-6">
                <label class="form-label" for="emp-dept">Department</label>
                <input id="emp-dept" name="department" class="form-control">
              </div>
              <div class="col-12 col-md-6">
                <label class="form-label" for="emp-pos">Position</label>
                <input id="emp-pos" name="position" class="form-control">
              </div>

              <div class="col-12 col-md-6">
                <label class="form-label" for="emp-salary">Annual salary (ZAR)</label>
                <input id="emp-salary" name="salary" type="number" min="0" class="form-control">
              </div>

              <div class="col-12">
                <label class="form-label" for="emp-notes">Notes / History</label>
                <textarea id="emp-notes" name="notes" rows="3" class="form-control"></textarea>
              </div>

            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Save</button>
          </div>
        </form>
      </div>
    </div>

  </div>

  <!-- Bootstrap JS bundle (required for modal) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- App script: simple client-side rendering + optional fetch of data/employees.json -->
  <script type="module">
    // ----- Simple storage wrapper -----
    const Storage = {
      get(key, fallback=null){
        try { const raw = localStorage.getItem(key); return raw ? JSON.parse(raw) : fallback; } catch(e){ return fallback; }
      },
      set(key, value){ localStorage.setItem(key, JSON.stringify(value)); }
    };

    // ----- Embedded sample data -----
    const SAMPLE_DATA = [
      { "id":"E001","firstName":"Sibongile","lastName":"Nkosi","email":"sibongile.nkosi@moderntech.com","department":"Development","position":"Software Engineer","salary":70000,"Employment_History":"Joined in 2015, promoted to Senior in 2018" },
      { "id":"E002","firstName":"Lungile","lastName":"Moyo","email":"lungile.moyo@moderntech.com","department":"HR","position":"HR Manager","salary":80000,"EmploymentHistory":"Joined in 2013, promoted to Manager in 2017" },
      { "id":"E003","firstName":"Thabo","lastName":"Molefe","email":"thabo.molefe@moderntech.com","department":"QA","position":"Quality Analyst","salary":55000,"EmploymentHistory":"Joined in 2018" }
    ];

    // ----- DOM refs -----
    const tbody = document.getElementById('employees-tbody');
    const searchInput = document.getElementById('search');
    const form = document.getElementById('employee-form');


    // ----- Render table -----
    function renderTable(list){
      tbody.innerHTML = '';
      if(!list || list.length === 0){
        tbody.innerHTML = '<tr><td colspan="6" class="text-center small-muted py-4">No employees found</td></tr>';
        return;
      }

      list.forEach(emp => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${emp.id}</td>
          <td><strong>${emp.firstName} ${emp.lastName}</strong><div class="small-muted">${emp.email || ''}</div></td>
          <td class="col-dept">${emp.department || ''}</td>
          <td>${emp.position || ''}</td>
          <td>${formatCurrency(emp.salary)}</td>
          <td class="text-end">
            <button class="btn btn-sm btn-outline-primary btn-edit" data-id="${emp.id}">Edit</button>
            <button class="btn btn-sm btn-outline-danger btn-delete" data-id="${emp.id}">Delete</button>
          </td>
        `;
        tbody.appendChild(tr);
      });

      // attach event listeners (delegate)
      tbody.querySelectorAll('.btn-edit').forEach(b=> b.addEventListener('click', onEdit));
      tbody.querySelectorAll('.btn-delete').forEach(b=> b.addEventListener('click', onDelete));
    }

    function formatCurrency(val){
      if(!val && val !== 0) return '-';
      return new Intl.NumberFormat('en-ZA',{style:'currency',currency:'ZAR'}).format(Number(val));
    }

    // ----- Search/filter -----
    function applySearch(data, q){
      if(!q) return data;
      q = q.trim().toLowerCase();
      return data.filter(e => (
        (e.id||'').toLowerCase().includes(q) ||
        (e.firstName||'').toLowerCase().includes(q) ||
        (e.lastName||'').toLowerCase().includes(q) ||
        (e.email||'').toLowerCase().includes(q)
      ));
    }

    // ----- Edit / Delete handlers -----
    function onEdit(e){
      const id = e.currentTarget.dataset.id;
      const employees = Storage.get('employees', []);
      const emp = employees.find(x=>x.id===id);
      if(!emp) return alert('Employee not found');

      // populate form fields
      form['id'].value = emp.id;
      form['firstName'].value = emp.firstName || '';
      form['lastName'].value = emp.lastName || '';
      form['email'].value = emp.email || '';
      form['department'].value = emp.department || '';
      form['position'].value = emp.position || '';
      form['salary'].value = emp.salary || '';
      form['notes'].value = emp.notes || '';

      // open modal programmatically (Bootstrap)
      const modalEl = document.getElementById('employeeModal');
      const modal = bootstrap.Modal.getOrCreateInstance(modalEl);
      modal.show();
    }

    function onDelete(e){
      const id = e.currentTarget.dataset.id;
      if(!confirm('Delete employee ' + id + '?')) return;
      let employees = Storage.get('employees', []);
      employees = employees.filter(x=> x.id !== id);
      Storage.set('employees', employees);
      renderTable(applySearch(employees, searchInput.value));
    }

    // ----- Form submit (add or update) -----
    form.addEventListener('submit', function(ev){
      ev.preventDefault();
      const formData = new FormData(form);
      const obj = Object.fromEntries(formData.entries());

      // normalize salary
      if(obj.salary) obj.salary = Number(obj.salary);

      let employees = Storage.get('employees', []);
      const existingIndex = employees.findIndex(x=> x.id === obj.id);
      if(existingIndex >= 0){
        // update
        employees[existingIndex] = {...employees[existingIndex], ...obj};
      } else {
        // add new
        employees.push(obj);
      }
      Storage.set('employees', employees);
      // close modal
      bootstrap.Modal.getInstance(document.getElementById('employeeModal')).hide();
      form.reset();
      renderTable(applySearch(employees, searchInput.value));
    });

    // ----- Add button clears form for new record -----
    document.getElementById('btn-add').addEventListener('click', ()=>{
      form.reset();
      // ensure id field editable for new employee
      form['id'].removeAttribute('readonly');
    });

    // ----- Wire search input -----
    searchInput.addEventListener('input', ()=>{
      const employees = Storage.get('employees', []);
      renderTable(applySearch(employees, searchInput.value));
    });

    // ----- Init -----
    (async function init(){
      await loadData();
      const employees = Storage.get('employees', []);
      renderTable(employees);
    })();

  </script>
</body>
</html>
